<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Binomial change point analysis • mcp</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Binomial change point analysis">
<meta property="og:description" content="mcp">
<meta property="og:image" content="https://github.com/lindeloev/mcp/raw/master/man/figures/logo.png">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@jonaslindeloev">
<meta name="twitter:site" content="@jonaslindeloev">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-1026978-3"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-1026978-3');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mcp</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    General usage
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/formulas.html">Formulas</a>
    </li>
    <li>
      <a href="../articles/priors.html">Priors</a>
    </li>
    <li>
      <a href="../articles/comparison.html">Hypotheses and model comparison</a>
    </li>
    <li>
      <a href="../articles/varying.html">Random/varying effects</a>
    </li>
    <li>
      <a href="../articles/variance.html">Modeling variance</a>
    </li>
    <li>
      <a href="../articles/arma.html">Time series and autocorrelation</a>
    </li>
    <li>
      <a href="../articles/predict.html">Fits and predictions</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    GLM
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/families.html">Supported families and link functions</a>
    </li>
    <li>
      <a href="../articles/poisson.html">Poisson</a>
    </li>
    <li>
      <a href="../articles/binomial.html">Binomial and Bernoulli</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Other
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/packages.html">Comparison to other packages</a>
    </li>
    <li>
      <a href="../articles/debug.html">Tips, tricks, and debugging</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li>
  <a href="https://twitter.com/jonaslindeloev">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/lindeloev/mcp">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/lindeloev/mcp/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Binomial change point analysis</h1>
                        <h4 class="author">Jonas Kristoffer Lindeløv</h4>
            
            <h4 class="date">2020-08-02</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/lindeloev/mcp/blob/master/vignettes/binomial.Rmd"><code>vignettes/binomial.Rmd</code></a></small>
      <div class="hidden name"><code>binomial.Rmd</code></div>

    </div>

    
    
<p><code>mcp</code> aims to implement Generalized Linear Models in a way that closely mimics that of <a href="https://github.com/paul-buerkner/brms">brms::brm</a>. You can set the family and link functions using the <code>family</code> argument.</p>
<p>First, let us specify a toy model with three segments:</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="no">model</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
  <span class="no">y</span> <span class="kw">|</span> <span class="fu">trials</span>(<span class="no">N</span>) ~ <span class="fl">1</span>,  <span class="co"># constant rate</span>
  ~ <span class="fl">0</span> + <span class="no">year</span>,  <span class="co"># joined changing rate</span>
  ~ <span class="fl">1</span> + <span class="no">year</span>  <span class="co"># disjoined changing rate</span>
)</pre></body></html></div>
<div id="simulate-data" class="section level1">
<h1 class="hasAnchor">
<a href="#simulate-data" class="anchor"></a>Simulate data</h1>
<p>If you already have data, you can safely skip this section.</p>
<p>We run <code>mcp</code> with <code>sample = FALSE</code> to get what we need to simulate data.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">mcp</span>)
<span class="no">empty</span> <span class="kw">=</span> <span class="fu"><a href="../reference/mcp.html">mcp</a></span>(<span class="no">model</span>, <span class="kw">family</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span>(), <span class="kw">sample</span> <span class="kw">=</span> <span class="fl">FALSE</span>)</pre></body></html></div>
<p>Now we can simulate. First, let us see the model parameters.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">empty</span>$<span class="no">pars</span></pre></body></html></div>
<pre><code>## $x
## [1] "year"
## 
## $y
## [1] "y"
## 
## $trials
## [1] "N"
## 
## $weights
## NULL
## 
## $varying
## NULL
## 
## $sigma
## character(0)
## 
## $arma
## character(0)
## 
## $reg
## [1] "cp_1"   "cp_2"   "int_1"  "int_3"  "year_2" "year_3"
## 
## $population
## [1] "cp_1"   "cp_2"   "int_1"  "int_3"  "year_2" "year_3"</code></pre>
<ul>
<li>It takes two intercepts (<code>int_*</code>), for segments 1 and 3.</li>
<li>It takes two slopes (<code>year_*</code>), for segment 2 and 3.</li>
<li>It takes two change points (<code>cp_*</code>) - one between each segment.</li>
</ul>
<p><code>empty$simulate</code> is now a function that can predict data given these parameters. If you are in a reasonable R editor, type <code>empty$simulate(</code> and press TAB to see the required arguments. I came up with some values below, including change points at <span class="math inline">\(year = 25\)</span> and <span class="math inline">\(year = 65\)</span>. Notice that because <code><a href="https://rdrr.io/r/stats/family.html">binomial()</a></code> defaults to the link function <code>link = "logit"</code>, the intercept and slopes are on a <a href="https://en.wikipedia.org/wiki/Logit">logit scale</a>. Briefly, this extends the narrow range of binomial rates (0-1) to an infinite logit scale from minus infinity to plus infinity. This will be important later when we set priors.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">df</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(
  <span class="kw">year</span> <span class="kw">=</span> <span class="fl">1901</span>:<span class="fl">2000</span>,  <span class="co"># evaluate for each of these</span>
  <span class="kw">N</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="fl">10</span>:<span class="fl">20</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="fl">100</span>, <span class="kw">replace</span> <span class="kw">=</span> <span class="fl">TRUE</span>)  <span class="co"># number of trials</span>
)
<span class="no">df</span>$<span class="no">y</span> <span class="kw">=</span> <span class="no">empty</span>$<span class="fu"><a href="https://rdrr.io/r/stats/simulate.html">simulate</a></span>(
  <span class="no">df</span>$<span class="no">year</span>, <span class="no">df</span>$<span class="no">N</span>,
  <span class="kw">cp_1</span> <span class="kw">=</span> <span class="fl">1925</span>, <span class="kw">cp_2</span> <span class="kw">=</span> <span class="fl">1965</span>,
  <span class="kw">int_1</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">int_3</span> <span class="kw">=</span> <span class="fl">0</span>,
  <span class="kw">year_2</span> <span class="kw">=</span> -<span class="fl">0.2</span>, <span class="kw">year_3</span> <span class="kw">=</span> <span class="fl">0.05</span>)

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">df</span>)</pre></body></html></div>
<pre><code>##   year  N  y
## 1 1901 12  9
## 2 1902 20 16
## 3 1903 10  7
## 4 1904 16 13
## 5 1905 20 18
## 6 1906 19 19</code></pre>
<p>Visually:</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="fu"><a href="../reference/plot.mcpfit.html">plot</a></span>(<span class="no">df</span>$<span class="no">year</span>, <span class="no">df</span>$<span class="no">y</span>)</pre></body></html></div>
<p><img src="binomial_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
</div>
<div id="check-parameter-recovery" class="section level1">
<h1 class="hasAnchor">
<a href="#check-parameter-recovery" class="anchor"></a>Check parameter recovery</h1>
<p>The next sections go into more detail, but let us quickly see if we can recover the parameters used to simulate the data.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">fit</span> <span class="kw">=</span> <span class="fu"><a href="../reference/mcp.html">mcp</a></span>(<span class="no">model</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">df</span>, <span class="kw">family</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span>(), <span class="kw">adapt</span> <span class="kw">=</span> <span class="fl">5000</span>)</pre></body></html></div>
<p>We can use <code>summary</code> to see that it recovered the parameters to a pretty good precision. Again, recall that intercepts and slopes are on a <code>logit</code> scale.</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="fu"><a href="../reference/summary.mcpfit.html">summary</a></span>(<span class="no">fit</span>)</pre></body></html></div>
<pre><code>## Family: binomial(link = 'logit')
## Iterations: 9000 from 3 chains.
## Segments:
##   1: y | trials(N) ~ 1
##   2: y | trials(N) ~ 1 ~ 0 + year
##   3: y | trials(N) ~ 1 ~ 1 + year
## 
## Population-level parameters:
##    name match     sim     mean    lower    upper Rhat n.eff
##    cp_1    OK 1925.00 1921.455 1914.918 1926.126  1.4   134
##    cp_2       1965.00 1956.733 1943.330 1965.000  3.9     4
##   int_1    OK    2.00    2.026    1.655    2.379  1.0   721
##   int_3    OK    0.00   -1.113   -3.344    0.429  3.8     4
##  year_2         -0.20   -0.150   -0.189   -0.099  2.1    40
##  year_3    OK    0.05    0.066    0.028    0.109  3.2     7</code></pre>
<p><code>summary</code> uses 95% highest density intervals (HDI) by default, but you can change it using <code><a href="../reference/summary.mcpfit.html">summary(fit, width = 0.80)</a></code>. If you have <a href="../articles/varying.html">varying effects</a>, use <code><a href="../reference/summary.mcpfit.html">ranef(fit)</a></code> to see them.</p>
<p>Plotting the fit confirms good fit to the data, and we see the discontinuities at the two change points:</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="fu"><a href="../reference/plot.mcpfit.html">plot</a></span>(<span class="no">fit</span>)</pre></body></html></div>
<p><img src="binomial_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<p>These lines are just <code>fit$simulate</code> applied to a random draw of the posterior samples. In other words, they represent the joint distribution of the parameters. You can change the number of draws (lines) using <code><a href="../reference/plot.mcpfit.html">plot(fit, lines = 50)</a></code>.</p>
<p>Notice for binomial models it defaults to plot the <em>rate</em> (<code>y / N</code>) as a function of x. The reason why is obvious when we plot on “raw” data by toggling <code>rate</code>:</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="fu"><a href="../reference/plot.mcpfit.html">plot</a></span>(<span class="no">fit</span>, <span class="kw">rate</span> <span class="kw">=</span> <span class="fl">FALSE</span>)</pre></body></html></div>
<p><img src="binomial_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>These lines are jagged because <code>N</code> varies from year to year. Although there is close too 100% success rate in the years 1900 - 1920, the number of trials varies, as you can see in the raw data. However, using <code>rate = FALSE</code> will be great when the number of trials is constant for extended periods of time, as <code>y</code> is more interpretable then.</p>
<p>Speaking of alternative visualizations, you can also plot this on the logit scale, where the linear trends are modeled:</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="fu"><a href="../reference/plot.mcpfit.html">plot</a></span>(<span class="no">fit</span>, <span class="kw">scale</span> <span class="kw">=</span> <span class="st">"linear"</span>)</pre></body></html></div>
<p><img src="binomial_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<p>Of course, these plots work with <a href="../articles/varying.html">varying effects</a> as well.</p>
</div>
<div id="model-diagnostics-and-sampling-options" class="section level1">
<h1 class="hasAnchor">
<a href="#model-diagnostics-and-sampling-options" class="anchor"></a>Model diagnostics and sampling options</h1>
<p>Already in the default <code>plot</code> as used above, it will be obvious if there was poor convergence. A more direct assessment is to look at the posterior distributions and trace plots:</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="fu"><a href="../reference/plot_pars.html">plot_pars</a></span>(<span class="no">fit</span>)</pre></body></html></div>
<p><img src="binomial_files/figure-html/unnamed-chunk-11-1.png" width="576"></p>
<p>Convergence is perfect here as evidenced by the overlapping trace plots that look like fat caterpillars (Bayesians love fat caterpillars). Notice that the posterior distribution of change points can be quite non-normal and sometimes even bimodal. Therefore, one should be careful not to interpret the HDI as if it was normal.</p>
<p><code><a href="../reference/plot.mcpfit.html">plot()</a></code> and <code><a href="../reference/plot_pars.html">plot_pars()</a></code> can do a lot more than this, so check out their documentation.</p>
</div>
<div id="priors-for-binomial-models" class="section level1">
<h1 class="hasAnchor">
<a href="#priors-for-binomial-models" class="anchor"></a>Priors for binomial models</h1>
<p><code>mcp</code> uses priors to achieve a lot of it’s functionality. See <a href="../articles/priors.html">how to set priors</a>, including how to share parameters between segments and how to fix values. Here, I post a few notes about the binomial-specific default priors.</p>
<p>The default priors in <code>mcp</code> are set so that they are reasonably broad to cover most scenarios, though also specific enough to sample effectively. They are not “default” as in “canonical”. Rather, they are “default” as in “what happens if you do nothing else”. All priors are stored in <code>fit$prior</code> (also <code>empty$prior</code>). We did not specify <code>prior</code> above, so it ran with default priors:</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="no">fit</span>$<span class="no">prior</span>)</pre></body></html></div>
<pre><code>##        [,1]                                                    
## cp_1   "dt(MINX, (MAXX - MINX) / N_CP, N_CP - 1) T(cp_0, MAXX)"
## cp_2   "dt(MINX, (MAXX - MINX) / N_CP, N_CP - 1) T(cp_1, MAXX)"
## int_1  "dnorm(0, 3)"                                           
## int_3  "dnorm(0, 3)"                                           
## year_2 "dnorm(0, 3 / (MAXX - MINX))"                           
## year_3 "dnorm(0, 3 / (MAXX - MINX))"</code></pre>
<p>The priors on change points are discussed extensively in the prior vignette. The priors on slopes and intercepts are normals with standard deviation of “3” logits. This corresponds to quite extreme binomial probabilities, yet not so extreme as to be totally flat. Here are visualization of priors <code><a href="https://rdrr.io/r/stats/Normal.html">dnorm(0, 1)</a></code> (red), <code><a href="https://rdrr.io/r/stats/Normal.html">dnorm(0, 2)</a></code> (black, mcp default), and a <code><a href="https://rdrr.io/r/stats/Normal.html">dnorm(0, 5)</a></code> (blue) prior, and the correspondence between logits and probabilities:</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="no">inverse_logit</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>) <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(<span class="no">x</span>) / (<span class="fl">1</span> + <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(<span class="no">x</span>))

<span class="co"># Start the plot</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">logits</span> <span class="kw">=</span> <span class="fl">0</span>), <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">logits</span>)) +

  <span class="co"># Plot normal prior. Set parameters in "args"</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_function.html">stat_function</a></span>(<span class="kw">fun</span><span class="kw">=</span><span class="no">dnorm</span>, <span class="kw">args</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">mean</span><span class="kw">=</span><span class="fl">0</span>, <span class="kw">sd</span> <span class="kw">=</span> <span class="fl">1</span>), <span class="kw">lwd</span><span class="kw">=</span><span class="fl">2</span>, <span class="kw">col</span><span class="kw">=</span><span class="st">"red"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_function.html">stat_function</a></span>(<span class="kw">fun</span><span class="kw">=</span><span class="no">dnorm</span>, <span class="kw">args</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">mean</span><span class="kw">=</span><span class="fl">0</span>, <span class="kw">sd</span> <span class="kw">=</span> <span class="fl">3</span>), <span class="kw">lwd</span><span class="kw">=</span><span class="fl">2</span>, <span class="kw">col</span><span class="kw">=</span><span class="st">"black"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_function.html">stat_function</a></span>(<span class="kw">fun</span><span class="kw">=</span><span class="no">dnorm</span>, <span class="kw">args</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">mean</span><span class="kw">=</span><span class="fl">0</span>, <span class="kw">sd</span> <span class="kw">=</span> <span class="fl">5</span>), <span class="kw">lwd</span><span class="kw">=</span><span class="fl">2</span>, <span class="kw">col</span><span class="kw">=</span><span class="st">"blue"</span>) +

  <span class="co"># Set the secondary axis</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span>(<span class="kw">breaks</span> <span class="kw">=</span> -<span class="fl">7</span>:<span class="fl">7</span>,<span class="kw">limits</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">7</span>, <span class="fl">7</span>), <span class="kw">sec.axis</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/sec_axis.html">sec_axis</a></span>(~ <span class="fu">inverse_logit</span>(<span class="no">.</span>), <span class="kw">name</span> <span class="kw">=</span> <span class="st">"Probability"</span>, <span class="kw">breaks</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="fu">inverse_logit</span>(<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(-<span class="fl">7</span>, <span class="fl">7</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="fl">2</span>)), <span class="fl">3</span>)))</pre></body></html></div>
<p><img src="binomial_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
<p>Please keep in mind that when these priors combine through the model, the joint probability may be quite different.</p>
<p>Returning to the priors, the <code>3 / (MAXX - MINX)</code> on slopes mean that this change in probability occurs over the course of the observed X.</p>
</div>
<div id="jags-code" class="section level1">
<h1 class="hasAnchor">
<a href="#jags-code" class="anchor"></a>JAGS code</h1>
<p>Here is the JAGS code for the model used in this article.</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="no">fit</span>$<span class="no">jags_code</span>)</pre></body></html></div>
<pre><code>## 
## model {
## 
##   # Priors for population-level effects
##   cp_0 = MINX  # mcp helper value.
##   cp_3 = MAXX  # mcp helper value.
## 
##   cp_1 ~ dt(MINX, 1/((MAXX-MINX)/N_CP)^2, N_CP-1) T(cp_0, MAXX)
##   cp_2 ~ dt(MINX, 1/((MAXX-MINX)/N_CP)^2, N_CP-1) T(cp_1, MAXX)
##   int_1 ~ dnorm(0, 1/(3)^2) 
##   int_3 ~ dnorm(0, 1/(3)^2) 
##   year_2 ~ dnorm(0, 1/(3/(MAXX-MINX))^2) 
##   year_3 ~ dnorm(0, 1/(3/(MAXX-MINX))^2) 
## 
## 
##   # Model and likelihood
##   for (i_ in 1:length(year)) {
##     X_1_[i_] = min(year[i_], cp_1)
##     X_2_[i_] = min(year[i_], cp_2) - cp_1
##     X_3_[i_] = min(year[i_], cp_3) - cp_2
##     
##     # Fitted value
##     y_[i_] = 
##     
##       # Segment 1: y | trials(N) ~ 1
##       (year[i_] &gt;= cp_0) * (year[i_] &lt; cp_2) * int_1 + 
##     
##       # Segment 2: y | trials(N) ~ 1 ~ 0 + year
##       (year[i_] &gt;= cp_1) * (year[i_] &lt; cp_2) * year_2 * X_2_[i_] + 
##     
##       # Segment 3: y | trials(N) ~ 1 ~ 1 + year
##       (year[i_] &gt;= cp_2) * int_3 + 
##       (year[i_] &gt;= cp_2) * year_3 * X_3_[i_] 
## 
##     # Likelihood and log-density for family = binomial()
##     y[i_] ~ dbin(ilogit(y_[i_]), N[i_])
##     loglik_[i_] = logdensity.bin(y[i_], ilogit(y_[i_]), N[i_])
##   }
## }</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="http://lindeloev.net">Jonas Kristoffer Lindeløv</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '702ab134d40a7310606c29f341fc5014',
    indexName: 'lindeloev_mcp',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
