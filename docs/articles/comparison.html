<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Change point model comparison with mcp • mcp</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Change point model comparison with mcp">
<meta property="og:description" content="">
<meta property="og:image" content="https://lindeloev.github.io/mcp/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-1026978-3"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-1026978-3');
</script>
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mcp</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    General usage
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/formulas.html">Formulas</a>
    </li>
    <li>
      <a href="../articles/priors.html">Priors</a>
    </li>
    <li>
      <a href="../articles/comparison.html">Hypotheses and model comparison</a>
    </li>
    <li>
      <a href="../articles/varying.html">Random/varying effects</a>
    </li>
    <li>
      <a href="../articles/variance.html">Modeling variance</a>
    </li>
    <li>
      <a href="../articles/arma.html">Time series and autocorrelation</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    GLM
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/poisson.html">Poisson</a>
    </li>
    <li>
      <a href="../articles/binomial.html">Binomial and Bernoulli</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Other
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/packages.html">Comparison to other packages</a>
    </li>
    <li>
      <a href="../articles/debug.html">Tips, tricks, and debugging</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li>
  <a href="https://twitter.com/jonaslindeloev">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/lindeloev/mcp">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Change point model comparison with mcp</h1>
                        <h4 class="author">Jonas Kristoffer Lindeløv</h4>
            
            <h4 class="date">2020-01-10</h4>
      
      
      <div class="hidden name"><code>comparison.Rmd</code></div>

    </div>

    
    
<p>There are three main ways of doing model comparison in <code>mcp</code>:</p>
<ul>
<li>Compare any N <code>mcp</code> models using leave-One-Out cross validation (LOO-CV). Check out <code><a href="../reference/criterion.html">loo(fit)</a></code>, <code><a href="https://mc-stan.org/loo/reference/loo_compare.html">loo::loo_compare(fit1$loo, fit2$loo, ...)</a></code>, and <code><a href="https://mc-stan.org/loo/reference/loo_model_weights.html">loo::loo_model_weights(fit1$loo, fit2$loo, ...)</a></code>.</li>
<li>Flexible directional tests using <code><a href="../reference/hypothesis.html">hypothesis(fit, cp_1 &gt; 40)</a></code> or <code><a href="../reference/hypothesis.html">hypothesis(fit, cp_1 &gt; 40 &amp; x_2 &gt; x_1)</a></code>.</li>
<li>Point Bayes Factors tests using the Savage-Dickey density ratio, e.g., <code><a href="../reference/hypothesis.html">hypothesis(fit, cp_1 = 50)</a></code> or <code><a href="../reference/hypothesis.html">hypothesis(fit, x_2 = x_1)</a></code>.</li>
</ul>
<div id="some-models-to-play-with" class="section level1">
<h1 class="hasAnchor">
<a href="#some-models-to-play-with" class="anchor"></a>Some models to play with</h1>
<p>We know quite a bit about human short term memory. Namely, the average human has almost perfect recall when presented with 1-4 items (we remember them all), and then errors begins intruding when presented with more items <a href="https://www.ncbi.nlm.nih.gov/pubmed/11515286">(Cowan, 2001)</a>. We also know that memory is not infinite, so as <span class="math inline">\(N \rightarrow \infty\)</span>, it has to plateau.</p>
<p>In other words, on “easy” trials with <span class="math inline">\(N &lt;= capacity\)</span> items to be recalled, we expect a constant high binomial rate. When <span class="math inline">\(N &gt; capacity\)</span>, the rate declines. We specify a prior reflecting our a priori knowledge.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1">model =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(</a>
<a class="sourceLine" id="cb1-2" title="2">  recalled <span class="op">|</span><span class="st"> </span><span class="kw">trials</span>(items) <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb1-3" title="3">  <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>items</a>
<a class="sourceLine" id="cb1-4" title="4">)</a>
<a class="sourceLine" id="cb1-5" title="5">prior =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(</a>
<a class="sourceLine" id="cb1-6" title="6">  <span class="dt">int_1 =</span> <span class="st">"dnorm(2, 1)"</span>,  <span class="co"># high recall for easy trials</span></a>
<a class="sourceLine" id="cb1-7" title="7">  <span class="dt">cp_1 =</span> <span class="st">"dnorm(4, 1)"</span>,  <span class="co"># performance dicontinuity around 4</span></a>
<a class="sourceLine" id="cb1-8" title="8">  <span class="dt">items_2 =</span> <span class="st">"dnorm(-0.4, 1) T( , -0.2)"</span>  <span class="co"># performance deteriorates considerably</span></a>
<a class="sourceLine" id="cb1-9" title="9">)</a>
<a class="sourceLine" id="cb1-10" title="10"></a>
<a class="sourceLine" id="cb1-11" title="11"><span class="co"># A very simple model</span></a>
<a class="sourceLine" id="cb1-12" title="12">model_simple =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(recalled <span class="op">|</span><span class="st"> </span><span class="kw">trials</span>(items) <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>items)</a></code></pre></div>
<p>Notice that <code>items</code> is used both as <code>trials</code> and x-axis. No problem.</p>
<p>Simulate some data using <code>fit$simulate()</code>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(mcp)</a>
<a class="sourceLine" id="cb2-2" title="2"><span class="kw"><a href="https://rdrr.io/r/base/options.html">options</a></span>(<span class="dt">mc.cores =</span> <span class="dv">3</span>)  <span class="co"># Speed up sampling!</span></a>
<a class="sourceLine" id="cb2-3" title="3"></a>
<a class="sourceLine" id="cb2-4" title="4">empty =<span class="st"> </span><span class="kw"><a href="../reference/mcp.html">mcp</a></span>(model, <span class="dt">family =</span> <span class="kw"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span>(), <span class="dt">sample =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb2-5" title="5"></a>
<a class="sourceLine" id="cb2-6" title="6"><span class="kw"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="dv">42</span>)</a>
<a class="sourceLine" id="cb2-7" title="7">df =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="dt">items =</span> <span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">9</span>, <span class="dt">each =</span> <span class="dv">40</span>))</a>
<a class="sourceLine" id="cb2-8" title="8">df<span class="op">$</span>recalled =<span class="st"> </span>empty<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/stats/simulate.html">simulate</a></span>(</a>
<a class="sourceLine" id="cb2-9" title="9">  df<span class="op">$</span>items, </a>
<a class="sourceLine" id="cb2-10" title="10">  <span class="dt">cp_1 =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb2-11" title="11">  <span class="dt">int_1 =</span> <span class="fl">2.5</span>, </a>
<a class="sourceLine" id="cb2-12" title="12">  <span class="dt">items_2 =</span> <span class="fl">-0.4</span>, </a>
<a class="sourceLine" id="cb2-13" title="13">  <span class="dt">sigma =</span> <span class="fl">0.5</span>)</a></code></pre></div>
<p>Now fit it with and without the informative prior. We set <code>iter</code> fairly high because this model is not sampled effectively. We will also add <code>sample = "both"</code> to sample <em>both</em> prior and posterior. We will need both to compute point Bayes Factors using <code><a href="../reference/hypothesis.html">hypothesis()</a></code> later.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">fit_default =<span class="st"> </span><span class="kw"><a href="../reference/mcp.html">mcp</a></span>(model, <span class="dt">data =</span> df,             <span class="dt">family =</span> <span class="kw"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span>(), <span class="dt">sample =</span> <span class="st">"both"</span>, <span class="dt">iter =</span> <span class="dv">10000</span>)</a>
<a class="sourceLine" id="cb3-2" title="2">fit_info =<span class="st"> </span><span class="kw"><a href="../reference/mcp.html">mcp</a></span>(model, <span class="dt">data =</span> df, <span class="dt">prior =</span> prior, <span class="dt">family =</span> <span class="kw"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span>(), <span class="dt">sample =</span> <span class="st">"both"</span>, <span class="dt">iter =</span> <span class="dv">10000</span>)</a>
<a class="sourceLine" id="cb3-3" title="3">fit_simple =<span class="st"> </span><span class="kw"><a href="../reference/mcp.html">mcp</a></span>(model_simple, <span class="dt">data =</span> df,       <span class="dt">family =</span> <span class="kw"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span>(), <span class="dt">sample =</span> <span class="st">"both"</span>, <span class="dt">iter =</span> <span class="dv">10000</span>)</a></code></pre></div>
<p>We plot them and add a few <code>ggplot2</code> layers. We jitter the raw data in the middle plot, just to give a sense of the densities.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(patchwork)</a>
<a class="sourceLine" id="cb4-2" title="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(ggplot2)</a>
<a class="sourceLine" id="cb4-3" title="3"></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="kw"><a href="../reference/plot.mcpfit.html">plot</a></span>(fit_default) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">"Default"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-6" title="6"><span class="st">  </span></a>
<a class="sourceLine" id="cb4-7" title="7"><span class="kw"><a href="../reference/plot.mcpfit.html">plot</a></span>(fit_info) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-8" title="8"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">"Informed"</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-9" title="9"><span class="st">  </span><span class="kw">geom_jitter</span>(<span class="dt">height =</span> <span class="fl">0.05</span>, <span class="dt">color =</span> <span class="st">"red"</span>, <span class="dt">size =</span> <span class="fl">0.2</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-10" title="10"><span class="st">  </span></a>
<a class="sourceLine" id="cb4-11" title="11"><span class="kw"><a href="../reference/plot.mcpfit.html">plot</a></span>(fit_simple) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-12" title="12"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">"Simple"</span>)</a></code></pre></div>
<pre><code>## Warning in regularize.values(x, y, ties, missing(ties)): collapsing to unique
## 'x' values

## Warning in regularize.values(x, y, ties, missing(ties)): collapsing to unique
## 'x' values

## Warning in regularize.values(x, y, ties, missing(ties)): collapsing to unique
## 'x' values</code></pre>
<p><img src="comparison_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
</div>
<div id="bayes-factors-using-savage-dickey-density-ratios" class="section level1">
<h1 class="hasAnchor">
<a href="#bayes-factors-using-savage-dickey-density-ratios" class="anchor"></a>Bayes Factors using Savage-Dickey density ratios</h1>
<p>You can compute probabilities and Bayes Factors for various hypotheses using <code><a href="../reference/hypothesis.html">hypothesis()</a></code>. For example, let’s test the idea that the change point in recall occurs at four items:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="kw"><a href="../reference/hypothesis.html">hypothesis</a></span>(fit_default, <span class="st">"cp_1 = 4"</span>)</a></code></pre></div>
<pre><code>##     hypothesis     mean     lower    upper         p       BF
## 1 cp_1 - 4 = 0 0.144693 -1.454185 1.630162 0.7782485 3.509552</code></pre>
<p>Let’s unpack:</p>
<ul>
<li>
<code>hypothesis</code>: For internal convenience, <code>hypothesis</code> always re-arranges to test against zero.</li>
<li>
<code>mean</code>: When subtracting <span class="math inline">\(4\)</span>, the posterior distribution is very close, but somewhat dispersed.</li>
<li>
<code>lower</code> and <code>uppwer</code>: The interval width defaults to 95% highest density interval, but you can change it using <code><a href="../reference/hypothesis.html">hypothesis(..., width = 0.8)</a></code>. It is two-sided, so if you want the bound for a one-sided 5% test, just do <code>width = 0.975</code>.</li>
<li>
<code>BF</code>: The Savage-Dickey density ratio, which is a Bayes Factor. This is the factor by which the density increases from the prior to the posterior at <code>cp_1 = 4</code>. A <span class="math inline">\(BF &gt; 1\)</span> means that we now believe <em>more</em> in this value, <span class="math inline">\(BF = 1\)</span> means that our credence to this value is <em>unchanged</em>, and <span class="math inline">\(BF &lt; 1\)</span> means that we believe <em>less</em> in it.</li>
<li>
<code>p</code>: Because <code>BF</code> is an odds ratio, <code>p</code> can just be computed from it and contains no new information. For example, <span class="math inline">\(p = 0.95\)</span> corresponds to <span class="math inline">\(BF = 19\)</span>.</li>
</ul>
<p>Because <code>BF</code> and <code>p</code> depends directly on the prior in Savage-Dickey test, it is as much an expression of the prior as the posterior. Computing it for the higher-prior-density-at-cp_1=4 <code>fit_info</code>, we see a substantially lower BF because we already had a substantial prior belief in <code>cp_1 = 4</code>:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1"><span class="kw"><a href="../reference/hypothesis.html">hypothesis</a></span>(fit_info, <span class="st">"cp_1 = 4"</span>)</a></code></pre></div>
<pre><code>##     hypothesis      mean      lower    upper         p       BF
## 1 cp_1 - 4 = 0 0.2370218 -0.9887598 1.370463 0.5663504 1.306009</code></pre>
<p><a href="../articles/priors.html">The Dirichlet prior on change points</a> may be better than the default prior when testing point hypotheses on change points, but an informed prior beats both.</p>
</div>
<div id="directional-and-combinatoric-tests" class="section level1">
<h1 class="hasAnchor">
<a href="#directional-and-combinatoric-tests" class="anchor"></a>Directional and combinatoric tests</h1>
<p>Maybe we just want to test a few directional hypothesis. For example:</p>
<ul>
<li>Does recall begin to deteriorate when <code>cp_1 &gt; 3</code>?</li>
<li>Is the change point in the interval <code>cp_1 &gt; 3.5 &amp; cp_1 &lt; 4.5</code>?</li>
<li>The only constraint is your imagination. How about all hypotheses we may have at once? <code>cp_1 &gt; 3.5 &amp; cp_1 &lt; 4.5 &amp; items_2 &lt; -0.4 &amp; int_1 &gt; 2.5</code> against it’s inverse <code>(cp_1 &lt; 3.5 | cp_1 &gt; 4.5) &amp; items_2 &gt; -0.4 &amp; int_1 &lt; 2.5</code>
</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1"><span class="kw"><a href="../reference/hypothesis.html">hypothesis</a></span>(fit_info, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(</a>
<a class="sourceLine" id="cb10-2" title="2">  <span class="st">"cp_1 &gt; 3"</span>,</a>
<a class="sourceLine" id="cb10-3" title="3">  <span class="st">"cp_1 &gt; 3.5 &amp; cp_1 &lt; 4.5"</span>,</a>
<a class="sourceLine" id="cb10-4" title="4">  <span class="st">"cp_1 &gt; 3.5 &amp; cp_1 &lt; 4.5 &amp; items_2 &lt; -0.4 &amp; int_1 &gt; 2.5"</span>,</a>
<a class="sourceLine" id="cb10-5" title="5">  <span class="st">"(cp_1 &lt; 3.5 | cp_1 &gt; 4.5) &amp; items_2 &gt; -0.4 &amp; int_1 &lt; 2.5"</span></a>
<a class="sourceLine" id="cb10-6" title="6">))</a></code></pre></div>
<pre><code>##                                                 hypothesis     mean      lower
## 1                                             cp_1 - 3 &gt; 0 1.237022 0.01124017
## 2                                  cp_1 &gt; 3.5 &amp; cp_1 &lt; 4.5       NA         NA
## 3   cp_1 &gt; 3.5 &amp; cp_1 &lt; 4.5 &amp; items_2 &lt; -0.4 &amp; int_1 &gt; 2.5       NA         NA
## 4 (cp_1 &lt; 3.5 | cp_1 &gt; 4.5) &amp; items_2 &gt; -0.4 &amp; int_1 &lt; 2.5       NA         NA
##      upper         p          BF
## 1 2.370463 0.9697333 32.03964758
## 2       NA 0.5321000  1.13720881
## 3       NA 0.2863333  0.40121439
## 4       NA 0.0353000  0.03659169</code></pre>
<p>Because Bayes Factors are transitive, we can divide them to get the relative evidence for two hypotheses. Here, we get approximately <span class="math inline">\(0.40 / 0.04 = 10\)</span> in favor of hypothesis 3 over hypothesis 4.</p>
<p>There are more examples <a href="../reference/hypothesis.html">in the documentation for <code>hypothesis</code></a>, including how to test varying effects.</p>
<p><code>mcp</code> does nothing fancy for the directional tests, and you could do them yourself. Just takes the hypothesis verbatim into <code>mutate</code> and <code>summarise</code> the proportion of samples that “passes” this test. These are identical:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1"><span class="kw"><a href="../reference/hypothesis.html">hypothesis</a></span>(fit, <span class="st">"cp_1 &gt; 3.5 &amp; cp_1 &lt; 4.5"</span>)</a>
<a class="sourceLine" id="cb12-2" title="2"></a>
<a class="sourceLine" id="cb12-3" title="3"><span class="co"># ... is identical to</span></a>
<a class="sourceLine" id="cb12-4" title="4"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(dplyr)</a>
<a class="sourceLine" id="cb12-5" title="5">result =<span class="st"> </span>tidybayes<span class="op">::</span><span class="kw"><a href="http://mjskay.github.io/tidybayes/reference/tidy_draws.html">tidy_draws</a></span>(fit<span class="op">$</span>mcmc_post) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-6" title="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">test =</span> cp_<span class="dv">1</span> <span class="op">&gt;</span><span class="st"> </span><span class="fl">3.5</span> <span class="op">&amp;</span><span class="st"> </span>cp_<span class="dv">1</span> <span class="op">&lt;</span><span class="st"> </span><span class="fl">4.5</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-7" title="7"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">p =</span> <span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(test) <span class="op">/</span><span class="st"> </span><span class="kw">n</span>())</a>
<a class="sourceLine" id="cb12-8" title="8"></a>
<a class="sourceLine" id="cb12-9" title="9"><span class="kw"><a href="../reference/summary.mcpfit.html">print</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">p =</span> result<span class="op">$</span>p, </a>
<a class="sourceLine" id="cb12-10" title="10">        <span class="dt">BF =</span> result<span class="op">$</span>p <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>result<span class="op">$</span>p)))</a></code></pre></div>
</div>
<div id="cross-validation" class="section level1">
<h1 class="hasAnchor">
<a href="#cross-validation" class="anchor"></a>Cross Validation</h1>
<p>We can use the cross-validation from the <code>loo</code> package to compare the predictive performance of <code>mcp</code> models. Use loo to compute Widely Applicable Information Criterion (WAIC) or Estimated Log Predictive Density (ELPD) for each model, and then compare them using <code><a href="https://mc-stan.org/loo/reference/loo_compare.html">loo::loo_compare()</a></code>.</p>
<p>The strength of LOO-CV is that you can compare any N models, as long as they are models of same data. In general, LOO-CV is the only inferential solution in <code>mcp</code> the models are not nested in each other. For example:</p>
<ul>
<li>The existence of one or several change points. The <a href="../articles/poisson.html">article on Poisson change points</a> contain an example of comparing a change-point model to a model without change points.</li>
<li>Models that differ by several parameters.</li>
<li>Comparing different priors.</li>
</ul>
<div id="what-is-loo-cv" class="section level2">
<h2 class="hasAnchor">
<a href="#what-is-loo-cv" class="anchor"></a>What is LOO-CV?</h2>
<p>You can read more about Leave-One-Out Cross Validation elsewhere, but briefly, it does this:</p>
<ol style="list-style-type: decimal">
<li>Computes the posteriors using all data <em>less one data point</em> (hence “leave one out”).</li>
<li>Computes the posterior density at the left-out data point (out-of-sample data), i.e., what probability the model assigned to it occurring. For example, if the posterior is a normal distribution, a data point near the mean of the posterior has higher density (it is less “surprising”) than if it is at <span class="math inline">\(z = -3\)</span>. Better predictions means higher densities, i.e., less surprisal.</li>
<li>Repeats step 2 for all observed data and multiplies these densities to get the combined predictive densities at unobserved data. Multiplying is the same as summing in log-space, and the latter has the advantage of being computationally much more feasible. I hope that the name “Estimated Log Predictive Density” (ELPD) makes sense now. The higher the ELPD, the better.</li>
</ol>
<p>As with Bayes Factors, you can obtain positive evidence for null models. The reason simpler models can be preferred in Bayes is that each new parameter increases the prior predictive space, and thereby comes with a greater “risk” of making way-off predictions. If the parameter does too little to “make up” for this by increasing the likelihood (making a difference), it is a net negative for predictive accuracy, and the simpler model will be preferred. So <em>narrower priors are simpler models</em>.</p>
<p>Also, if the data is reasonably informative (it almost always is), LOO-CV is much less influenced by priors than Bayes factors. For LOO, the priors can more be thought of as a regularization (a way to ensure that sampling is efficient) than as the point of departure which all our inferences are relative to (Bayes Factors).</p>
</div>
<div id="applied-example" class="section level2">
<h2 class="hasAnchor">
<a href="#applied-example" class="anchor"></a>Applied example</h2>
<p>We can look at the loo for one model:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1"><span class="kw"><a href="../reference/criterion.html">loo</a></span>(fit_info)</a></code></pre></div>
<pre><code>## 
## Computed from 30000 by 360 log-likelihood matrix
## 
##          Estimate   SE
## elpd_loo   -365.6 16.5
## p_loo         2.8  0.3
## looic       731.3 33.0
## ------
## Monte Carlo SE of elpd_loo is 0.0.
## 
## All Pareto k estimates are good (k &lt; 0.5).
## See help('pareto-k-diagnostic') for details.</code></pre>
<p>This is not terribly informative in and of itself. <span class="math inline">\(looic = -2 * elpd_loo\)</span> as is the corresponding SEs, so that is just a matter of scale. What ELPD tells you is that the product of the densities of all left-out data points is approximately <span class="math inline">\(exp(-335.2) ~ 10 ^ {-146}\)</span>, a vanishingly small number because we multiply many small numbers. This is hard to interpret because the density at a given point is a strange thing. Furthermore, it depends on the size of the dataset (the more small densities you multiply, the smaller the ELPD).</p>
<p>What is interesting is the <em>relative</em> differences in these predicted densities. We can compare the models using <code><a href="https://mc-stan.org/loo/reference/loo_compare.html">loo::loo_compare()</a></code>. We save the results in <code>fit$loo</code> to keep things together, which will also be useful if you want to <code><a href="https://rdrr.io/r/base/save.html">save(fit)</a></code> the objects for later use.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1">fit_default<span class="op">$</span>loo =<span class="st"> </span><span class="kw"><a href="../reference/criterion.html">loo</a></span>(fit_default)</a>
<a class="sourceLine" id="cb15-2" title="2">fit_info<span class="op">$</span>loo =<span class="st"> </span><span class="kw"><a href="../reference/criterion.html">loo</a></span>(fit_info)</a>
<a class="sourceLine" id="cb15-3" title="3">fit_simple<span class="op">$</span>loo =<span class="st"> </span><span class="kw"><a href="../reference/criterion.html">loo</a></span>(fit_simple)</a>
<a class="sourceLine" id="cb15-4" title="4"></a>
<a class="sourceLine" id="cb15-5" title="5">loo<span class="op">::</span><span class="kw"><a href="https://mc-stan.org/loo/reference/loo_compare.html">loo_compare</a></span>(fit_default<span class="op">$</span>loo, fit_info<span class="op">$</span>loo, fit_simple<span class="op">$</span>loo)</a></code></pre></div>
<pre><code>##        elpd_diff se_diff
## model2  0.0       0.0   
## model1 -0.5       0.2   
## model3 -4.2       2.8</code></pre>
<p>Aha, so the second model (“model2”, i.e., <code>fit_info</code>) passed to <code>loo_compare()</code> was preferred as the other models had smaller ELPDs. As a first rough conclusion, we’ve learned that informed priors and a plateau improved out-of-sample predictions.</p>
<p>Again, the absolute number (<code>elpd_diff</code>) is hard to relate to. More interpretable is the <code>elpd_diff</code>/<code>se_diff</code> ratio. This is almost like a z-score, i.e., a ratio of 1.96 corresponds to 95% probability that one model has superior predictive accuracy. This is not an <em>effect size</em> but more a measure of <em>certainty</em> that this is not compatible with equal predictive properties. Just like Bayes Factors, a nice property over frequentist p-values is that you can quantify the relative evidence for and against any pair of models without having to assume one of them as null.</p>
<p>Note that the <code>loo</code> developers have advised that this ratio is too optimistic in practice, but that one can be confident if it exceeds 5 [Citation needed]. So to conclude, none of these models above stand out as particularly good or bad.</p>
<p>You could do the same using <code>waic</code>. This is computationally lighter at the cost of robustness to influential data points. The results are almost always practically identical.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1">fit_default<span class="op">$</span>waic =<span class="st"> </span><span class="kw"><a href="../reference/criterion.html">waic</a></span>(fit_default)</a>
<a class="sourceLine" id="cb17-2" title="2">fit_info<span class="op">$</span>waic =<span class="st"> </span><span class="kw"><a href="../reference/criterion.html">waic</a></span>(fit_info)</a>
<a class="sourceLine" id="cb17-3" title="3">fit_simple<span class="op">$</span>waic =<span class="st"> </span><span class="kw"><a href="../reference/criterion.html">waic</a></span>(fit_simple)</a>
<a class="sourceLine" id="cb17-4" title="4"></a>
<a class="sourceLine" id="cb17-5" title="5">loo<span class="op">::</span><span class="kw"><a href="https://mc-stan.org/loo/reference/loo_compare.html">loo_compare</a></span>(fit_default<span class="op">$</span>waic, fit_info<span class="op">$</span>waic, fit_simple<span class="op">$</span>waic)</a></code></pre></div>
<pre><code>##        elpd_diff se_diff
## model2  0.0       0.0   
## model1 -0.5       0.2   
## model3 -4.2       2.8</code></pre>
</div>
<div id="stacking" class="section level2">
<h2 class="hasAnchor">
<a href="#stacking" class="anchor"></a>Stacking</h2>
<p>The <code>loo</code> package contains many other useful functions. For example, if prediction is your goal, it is often optimal to <em>combine</em> models rather than letting the “winner-takes-it-all” do all the predicting. This is also called <em>stacking</em>:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" title="1">loo<span class="op">::</span><span class="kw"><a href="https://mc-stan.org/loo/reference/loo_model_weights.html">stacking_weights</a></span>(fit_default<span class="op">$</span>loo, fit_info<span class="op">$</span>loo, fit_simple<span class="op">$</span>loo)</a></code></pre></div>
<p>What this means is that once model2 (<code>fit_info</code>) has done it’s “predicting”, the others add very little over and above that. If you want to learn about how well they predict relative to each other, use <code>loo::peudobma_weights()</code> which weights proportional to the ELPD of each model.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#some-models-to-play-with">Some models to play with</a></li>
      <li><a href="#bayes-factors-using-savage-dickey-density-ratios">Bayes Factors using Savage-Dickey density ratios</a></li>
      <li><a href="#directional-and-combinatoric-tests">Directional and combinatoric tests</a></li>
      <li>
<a href="#cross-validation">Cross Validation</a><ul class="nav nav-pills nav-stacked">
<li><a href="#what-is-loo-cv">What is LOO-CV?</a></li>
      <li><a href="#applied-example">Applied example</a></li>
      <li><a href="#stacking">Stacking</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="http://lindeloev.net">Jonas Kristoffer Lindeløv</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '702ab134d40a7310606c29f341fc5014',
    indexName: 'lindeloev_mcp',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
